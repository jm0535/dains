<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>10&nbsp; Advanced Modeling Techniques – Data Analysis in Natural Sciences</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/10-conservation.html" rel="next">
<link href="../chapters/08-regression.html" rel="prev">
<link href="../images/Rlogo.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-56b67755cebbfb78539c873898544994.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-f0bc7793ffdd46ddf3b99218c6954345.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-dark-5cb9b089ed55fbb2d9030d6bb4f5b5f8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-5cb9b089ed55fbb2d9030d6bb4f5b5f8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<meta name="description" content="A comprehensive guide to data analysis in natural sciences using R. Learn statistical methods, data visualization, and reproducible research practices.">
<meta name="keywords" content="R programming, data analysis, statistics, ecology, natural sciences, ggplot2, tidyverse, data visualization">
<meta name="author" content="Jimmy Moses">
<link rel="stylesheet" href="../styles.css">
</head>
<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/Rlogo.jpg" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">DAINS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jm0535/dains"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/jm0535/dains" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../Data-Analysis-in-Natural-Sciences.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/08-regression.html">Part IV: Statistical Modeling</a></li><li class="breadcrumb-item"><a href="../chapters/09-advanced-modeling.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Modeling Techniques</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Analysis in Natural Sciences</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-data-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Basics</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Data Analysis Fundamentals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-exploratory-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-hypothesis-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-statistical-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Common Statistical Tests</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-advanced-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced Data Visualization</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Statistical Modeling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Regression Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-advanced-modeling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Modeling Techniques</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Applied Ecology</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-conservation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Conservation Applications</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">10.1</span> Introduction</a></li>
  <li>
<a href="#model-interpretation-and-explainability" id="toc-model-interpretation-and-explainability" class="nav-link" data-scroll-target="#model-interpretation-and-explainability"><span class="header-section-number">10.2</span> Model Interpretation and Explainability</a>
  <ul class="collapse">
<li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance"><span class="header-section-number">10.2.1</span> Variable Importance</a></li>
  <li><a href="#partial-dependence-plots" id="toc-partial-dependence-plots" class="nav-link" data-scroll-target="#partial-dependence-plots"><span class="header-section-number">10.2.2</span> Partial Dependence Plots</a></li>
  <li><a href="#individual-conditional-expectation-ice-plots" id="toc-individual-conditional-expectation-ice-plots" class="nav-link" data-scroll-target="#individual-conditional-expectation-ice-plots"><span class="header-section-number">10.2.3</span> Individual Conditional Expectation (ICE) Plots</a></li>
  <li><a href="#explaining-individual-predictions" id="toc-explaining-individual-predictions" class="nav-link" data-scroll-target="#explaining-individual-predictions"><span class="header-section-number">10.2.4</span> Explaining Individual Predictions</a></li>
  </ul>
</li>
  <li>
<a href="#time-series-analysis-for-ecological-data" id="toc-time-series-analysis-for-ecological-data" class="nav-link" data-scroll-target="#time-series-analysis-for-ecological-data"><span class="header-section-number">10.3</span> Time Series Analysis for Ecological Data</a>
  <ul class="collapse">
<li><a href="#understanding-temporal-autocorrelation" id="toc-understanding-temporal-autocorrelation" class="nav-link" data-scroll-target="#understanding-temporal-autocorrelation"><span class="header-section-number">10.3.1</span> Understanding Temporal Autocorrelation</a></li>
  <li><a href="#time-series-decomposition" id="toc-time-series-decomposition" class="nav-link" data-scroll-target="#time-series-decomposition"><span class="header-section-number">10.3.2</span> Time Series Decomposition</a></li>
  <li><a href="#forecasting-with-arima-models" id="toc-forecasting-with-arima-models" class="nav-link" data-scroll-target="#forecasting-with-arima-models"><span class="header-section-number">10.3.3</span> Forecasting with ARIMA Models</a></li>
  <li><a href="#ecological-example-phenology-trends" id="toc-ecological-example-phenology-trends" class="nav-link" data-scroll-target="#ecological-example-phenology-trends"><span class="header-section-number">10.3.4</span> Ecological Example: Phenology Trends</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-summary" id="toc-chapter-summary" class="nav-link" data-scroll-target="#chapter-summary"><span class="header-section-number">10.4</span> Chapter Summary</a>
  <ul class="collapse">
<li><a href="#key-concepts" id="toc-key-concepts" class="nav-link" data-scroll-target="#key-concepts"><span class="header-section-number">10.4.1</span> Key Concepts</a></li>
  <li><a href="#r-functions-learned" id="toc-r-functions-learned" class="nav-link" data-scroll-target="#r-functions-learned"><span class="header-section-number">10.4.2</span> R Functions Learned</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">10.4.3</span> Next Steps</a></li>
  </ul>
</li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">10.5</span> Exercises</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/jm0535/dains/edit/main/chapters/09-advanced-modeling.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/jm0535/dains/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/jm0535/dains/blob/main/chapters/09-advanced-modeling.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/08-regression.html">Part IV: Statistical Modeling</a></li><li class="breadcrumb-item"><a href="../chapters/09-advanced-modeling.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Modeling Techniques</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-advanced-modeling" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Modeling Techniques</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this chapter, you will be able to:</p>
<ol type="1">
<li>Interpret machine learning models using model-agnostic methods</li>
<li>Calculate and visualize variable importance</li>
<li>Create partial dependence and ICE plots</li>
<li>Explain individual predictions with SHAP values</li>
<li>Analyze time series data with temporal autocorrelation</li>
<li>Decompose time series into trend, seasonal, and noise components</li>
<li>Build ARIMA models for forecasting</li>
<li>Account for temporal autocorrelation in regression models</li>
</ol>
</div>
</div>
<section id="introduction" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">10.1</span> Introduction</h2>
<p>This chapter explores advanced modeling techniques that extend beyond traditional regression. We’ll cover model interpretation methods that help us understand “black box” machine learning models, and time series analysis for data collected sequentially over time.</p>
</section><section id="model-interpretation-and-explainability" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="model-interpretation-and-explainability">
<span class="header-section-number">10.2</span> Model Interpretation and Explainability</h2>
<p>While machine learning models like Random Forest can achieve high predictive accuracy, understanding <em>why</em> they make specific predictions is crucial for ecological applications. Model interpretation helps us extract ecological insights and communicate results to stakeholders.</p>
<section id="variable-importance" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="variable-importance">
<span class="header-section-number">10.2.1</span> Variable Importance</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load packages for model interpretation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/DALEX/">DALEX</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ModelOriented.github.io/DALEXtra/">DALEXtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare the penguins data (same as chapter 08)</span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">penguins</a></span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split data into training and testing sets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">penguin_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">penguins</span>, prop <span class="op">=</span> <span class="fl">0.75</span>, strata <span class="op">=</span> <span class="va">species</span><span class="op">)</span></span>
<span><span class="va">penguin_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">penguin_split</span><span class="op">)</span></span>
<span><span class="va">penguin_test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">penguin_split</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a recipe for preprocessing</span></span>
<span><span class="va">penguin_recipe</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">bill_length_mm</span> <span class="op">+</span> <span class="va">bill_depth_mm</span> <span class="op">+</span></span>
<span>                         <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">species</span>,</span>
<span>                         data <span class="op">=</span> <span class="va">penguin_train</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_normalize</span><span class="op">(</span><span class="fu">all_numeric_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_zv</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define Random Forest model specification</span></span>
<span><span class="va">rf_spec</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create workflow</span></span>
<span><span class="va">rf_wf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">penguin_recipe</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">rf_spec</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the final model</span></span>
<span><span class="va">final_fit</span> <span class="op">&lt;-</span> <span class="va">rf_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguin_train</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an explainer object</span></span>
<span><span class="va">explainer_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ModelOriented.github.io/DALEXtra/reference/explain_tidymodels.html">explain_tidymodels</a></span><span class="op">(</span></span>
<span>  <span class="va">final_fit</span>,</span>
<span>  data <span class="op">=</span> <span class="va">penguin_test</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">body_mass_g</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="va">penguin_test</span><span class="op">$</span><span class="va">body_mass_g</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Random Forest"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate variable importance using permutation</span></span>
<span><span class="va">vi_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_parts.html">model_parts</a></span><span class="op">(</span><span class="va">explainer_rf</span>, loss_function <span class="op">=</span> <span class="va">loss_root_mean_square</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize variable importance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">vi_rf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Variable Importance for Body Mass Prediction"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Permutation-based importance shows contribution of each predictor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># Get the importance values</span></span>
<span><span class="va">vi_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">vi_rf</span><span class="op">)</span></span>
<span><span class="va">vi_summary</span> <span class="op">&lt;-</span> <span class="va">vi_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">!=</span> <span class="st">"_baseline_"</span>, <span class="va">variable</span> <span class="op">!=</span> <span class="st">"_full_model_"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    mean_dropout_loss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dropout_loss</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">mean_dropout_loss</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">vi_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 2</span></span>
<span><span class="co">#&gt;   variable          mean_dropout_loss</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 species                        574.</span></span>
<span><span class="co">#&gt; 2 flipper_length_mm              536.</span></span>
<span><span class="co">#&gt; 3 bill_depth_mm                  384.</span></span>
<span><span class="co">#&gt; 4 bill_length_mm                 351.</span></span>
<span><span class="co">#&gt; 5 island                         311.</span></span>
<span><span class="co">#&gt; 6 sex                            311.</span></span>
<span><span class="co">#&gt; 7 year                           311.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code Explanation
</div>
</div>
<div class="callout-body-container callout-body">
<p>This code demonstrates model-agnostic variable importance:</p>
<ol type="1">
<li>
<strong>DALEX Framework</strong>
<ul>
<li>Creates an “explainer” object that wraps the tidymodels workflow</li>
<li>Provides a unified interface for model interpretation</li>
<li>Works with any model type (linear, tree-based, neural networks)</li>
</ul>
</li>
<li>
<strong>Permutation Importance</strong>
<ul>
<li>Measures how much model performance decreases when a variable is randomly shuffled</li>
<li>Higher dropout loss = more important variable</li>
<li>Unlike tree-based importance, this works for any model and accounts for correlations</li>
</ul>
</li>
<li>
<strong>Interpretation</strong>
<ul>
<li>Variables are ranked by their contribution to predictions</li>
<li>Helps identify which morphological features are most predictive of body mass</li>
<li>Provides ecological insights into species morphology</li>
</ul>
</li>
</ol>
</div>
</div>
</section><section id="partial-dependence-plots" class="level3" data-number="10.2.2"><h3 data-number="10.2.2" class="anchored" data-anchor-id="partial-dependence-plots">
<span class="header-section-number">10.2.2</span> Partial Dependence Plots</h3>
<p>Partial dependence plots show how predictions change as a single variable varies, while averaging over all other variables.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create partial dependence profiles for key variables</span></span>
<span><span class="va">pdp_flipper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_profile.html">model_profile</a></span><span class="op">(</span></span>
<span>  <span class="va">explainer_rf</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"flipper_length_mm"</span>,</span>
<span>  N <span class="op">=</span> <span class="cn">NULL</span>  <span class="co"># Use all observations</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pdp_bill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_profile.html">model_profile</a></span><span class="op">(</span></span>
<span>  <span class="va">explainer_rf</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"bill_length_mm"</span>,</span>
<span>  N <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot partial dependence</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pdp_flipper</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Partial Dependence: Flipper Length"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Shows average effect of flipper length on predicted body mass"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Body Mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pdp_bill</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Partial Dependence: Bill Length"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Shows average effect of bill length on predicted body mass"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Bill Length (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Body Mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># Create 2D partial dependence plot for interactions</span></span>
<span><span class="va">pdp_2d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_profile.html">model_profile</a></span><span class="op">(</span></span>
<span>  <span class="va">explainer_rf</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"flipper_length_mm"</span>, <span class="st">"bill_length_mm"</span><span class="op">)</span>,</span>
<span>  N <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note: 2D plots require additional processing</span></span>
<span><span class="co"># For simplicity, we'll show individual effects</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Results Interpretation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Partial dependence plots reveal important ecological relationships:</p>
<ol type="1">
<li>
<strong>Marginal Effects</strong>
<ul>
<li>Shows how each predictor affects the response on average</li>
<li>Accounts for correlations between predictors</li>
<li>Reveals non-linear relationships that linear models would miss</li>
</ul>
</li>
<li>
<strong>Ecological Insights</strong>
<ul>
<li>Flipper length typically shows a strong positive relationship with body mass</li>
<li>The relationship may be non-linear (e.g., diminishing returns at large sizes)</li>
<li>Different species may show different patterns (captured by species variable)</li>
</ul>
</li>
<li>
<strong>Model Behavior</strong>
<ul>
<li>Helps validate that the model learned sensible relationships</li>
<li>Can reveal unexpected patterns that warrant further investigation</li>
<li>Useful for communicating model predictions to non-technical audiences</li>
</ul>
</li>
</ol>
</div>
</div>
</section><section id="individual-conditional-expectation-ice-plots" class="level3" data-number="10.2.3"><h3 data-number="10.2.3" class="anchored" data-anchor-id="individual-conditional-expectation-ice-plots">
<span class="header-section-number">10.2.3</span> Individual Conditional Expectation (ICE) Plots</h3>
<p>While partial dependence shows average effects, ICE plots show how predictions change for individual observations.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create ICE plots for flipper length</span></span>
<span><span class="va">ice_flipper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_profile.html">model_profile</a></span><span class="op">(</span></span>
<span>  <span class="va">explainer_rf</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"flipper_length_mm"</span>,</span>
<span>  N <span class="op">=</span> <span class="fl">50</span>,  <span class="co"># Use 50 observations for clarity</span></span>
<span>  type <span class="op">=</span> <span class="st">"conditional"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ICE curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ice_flipper</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Individual Conditional Expectation: Flipper Length"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Each line shows how prediction changes for one penguin"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Body Mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># Compare with partial dependence (average)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ice_flipper</span>, geom <span class="op">=</span> <span class="st">"profiles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"ICE Plots with Partial Dependence (yellow line)"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Individual effects vs. average effect"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted Body Mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
PROFESSIONAL TIP: Choosing Interpretation Methods
</div>
</div>
<div class="callout-body-container callout-body">
<p>When interpreting machine learning models for ecological applications:</p>
<ol type="1">
<li>
<strong>Variable Importance</strong>
<ul>
<li>Use permutation importance for model-agnostic assessment</li>
<li>Compare with domain knowledge to validate model behavior</li>
<li>Consider both statistical and ecological importance</li>
<li>Report confidence intervals when possible</li>
</ul>
</li>
<li>
<strong>Partial Dependence Plots</strong>
<ul>
<li>Show average marginal effects of predictors</li>
<li>Useful for understanding overall patterns</li>
<li>Can mask heterogeneous effects across observations</li>
<li>Best for communicating general relationships</li>
</ul>
</li>
<li>
<strong>ICE Plots</strong>
<ul>
<li>Reveal individual-level heterogeneity</li>
<li>Identify subgroups with different response patterns</li>
<li>More complex to interpret than PDP</li>
<li>Useful for detecting interactions</li>
</ul>
</li>
<li>
<strong>Break-Down Plots</strong> (for individual predictions)
<ul>
<li>Explain specific predictions step-by-step</li>
<li>Useful for understanding outliers or unusual cases</li>
<li>Helps build trust in model predictions</li>
<li>Essential for high-stakes conservation decisions</li>
</ul>
</li>
</ol>
</div>
</div>
</section><section id="explaining-individual-predictions" class="level3" data-number="10.2.4"><h3 data-number="10.2.4" class="anchored" data-anchor-id="explaining-individual-predictions">
<span class="header-section-number">10.2.4</span> Explaining Individual Predictions</h3>
<p>For specific conservation decisions, we often need to understand why the model made a particular prediction.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Select an interesting observation to explain</span></span>
<span><span class="va">observation_to_explain</span> <span class="op">&lt;-</span> <span class="va">penguin_test</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Explaining prediction for:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Explaining prediction for:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">observation_to_explain</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span>, <span class="va">flipper_length_mm</span>, <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span><span class="co">#&gt;   species bill_length_mm bill_depth_mm flipper_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;            &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie            39.1          18.7               181        3750</span></span>
<span></span>
<span><span class="co"># Create a break-down explanation</span></span>
<span><span class="va">bd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/predict_parts.html">predict_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">explainer_rf</span>,</span>
<span>  new_observation <span class="op">=</span> <span class="va">observation_to_explain</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"break_down"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the break-down</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">bd</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Break-Down Plot for Individual Prediction"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Shows contribution of each variable to the final prediction"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># Create SHAP values for more robust attribution</span></span>
<span><span class="va">shap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/predict_parts.html">predict_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">explainer_rf</span>,</span>
<span>  new_observation <span class="op">=</span> <span class="va">observation_to_explain</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"shap"</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">25</span>  <span class="co"># Number of random orderings</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot SHAP values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">shap</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SHAP Values for Individual Prediction"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Average contribution across all possible variable orderings"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code Explanation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Individual prediction explanations help understand specific cases:</p>
<ol type="1">
<li>
<strong>Break-Down Plots</strong>
<ul>
<li>Show step-by-step how each variable contributes to the prediction</li>
<li>Start from the average prediction and add each variable’s effect</li>
<li>Order matters: variables are added in order of importance</li>
</ul>
</li>
<li>
<strong>SHAP Values</strong>
<ul>
<li>Shapley Additive exPlanations from game theory</li>
<li>Average contribution across all possible orderings of variables</li>
<li>More robust than break-down plots but computationally intensive</li>
<li>Provides fair attribution of prediction to each feature</li>
</ul>
</li>
<li>
<strong>Ecological Applications</strong>
<ul>
<li>Explain why a particular species is predicted in a certain location</li>
<li>Understand which factors drive high/low abundance predictions</li>
<li>Communicate model reasoning to stakeholders and decision-makers</li>
<li>Identify data quality issues or model failures</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Communicating ML Results in Ecology
</div>
</div>
<div class="callout-body-container callout-body">
<p>When presenting machine learning results to ecological audiences:</p>
<ol type="1">
<li>
<strong>Focus on Ecological Meaning</strong>
<ul>
<li>Translate statistical importance to ecological significance</li>
<li>Connect model patterns to known ecological processes</li>
<li>Discuss biological plausibility of relationships</li>
<li>Relate findings to conservation implications</li>
</ul>
</li>
<li>
<strong>Visualize Effectively</strong>
<ul>
<li>Use partial dependence plots for main effects</li>
<li>Show uncertainty in predictions</li>
<li>Include actual data points alongside model predictions</li>
<li>Use colors and labels that resonate with ecological context</li>
</ul>
</li>
<li>
<strong>Acknowledge Limitations</strong>
<ul>
<li>Discuss what the model cannot capture (e.g., biotic interactions)</li>
<li>Explain extrapolation risks</li>
<li>Mention data quality and sampling bias issues</li>
<li>Suggest validation approaches</li>
</ul>
</li>
<li>
<strong>Provide Actionable Insights</strong>
<ul>
<li>Link predictions to management recommendations</li>
<li>Identify key variables that can be monitored or manipulated</li>
<li>Suggest priority areas for conservation action</li>
<li>Propose adaptive management strategies based on model uncertainty</li>
</ul>
</li>
</ol>
</div>
</div>
<p>Model interpretation transforms “black box” machine learning into a tool for ecological understanding. By explaining how models make predictions, we gain insights into ecological processes and build confidence in using ML for conservation decision-making.</p>
</section></section><section id="time-series-analysis-for-ecological-data" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="time-series-analysis-for-ecological-data">
<span class="header-section-number">10.3</span> Time Series Analysis for Ecological Data</h2>
<p>Time series data—observations collected sequentially over time—are common in ecology. Population counts, climate measurements, and phenological observations all have temporal structure that standard regression methods cannot properly handle.</p>
<section id="understanding-temporal-autocorrelation" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="understanding-temporal-autocorrelation">
<span class="header-section-number">10.3.1</span> Understanding Temporal Autocorrelation</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load packages for time series analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/">forecast</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tsibble.tidyverts.org">tsibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://feasts.tidyverts.org/">feasts</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create simulated population time series</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">1990</span><span class="op">:</span><span class="fl">2023</span></span>
<span><span class="va">n_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate population with trend, seasonality, and noise</span></span>
<span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_years</span><span class="op">)</span>  <span class="co"># Increasing trend</span></span>
<span><span class="va">seasonal</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_years</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span><span class="op">)</span>  <span class="co"># 5-year cycle</span></span>
<span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n_years</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">population</span> <span class="op">&lt;-</span> <span class="va">trend</span> <span class="op">+</span> <span class="va">seasonal</span> <span class="op">+</span> <span class="va">noise</span></span>
<span></span>
<span><span class="co"># Create time series data frame</span></span>
<span><span class="va">pop_ts_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="va">years</span>,</span>
<span>  population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize the time series</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">pop_ts_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Simulated Population Time Series"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Shows trend and cyclic pattern typical of ecological data"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Population Size"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># Test for temporal autocorrelation</span></span>
<span><span class="co"># Create ACF and PACF plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html">acf</a></span><span class="op">(</span><span class="va">pop_ts_data</span><span class="op">$</span><span class="va">population</span>, main <span class="op">=</span> <span class="st">"Autocorrelation Function (ACF)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html">pacf</a></span><span class="op">(</span><span class="va">pop_ts_data</span><span class="op">$</span><span class="va">population</span>, main <span class="op">=</span> <span class="st">"Partial Autocorrelation Function (PACF)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code Explanation
</div>
</div>
<div class="callout-body-container callout-body">
<p>This code introduces time series concepts for ecological data:</p>
<ol type="1">
<li>
<strong>Time Series Components</strong>
<ul>
<li>
<strong>Trend</strong>: Long-term increase or decrease (e.g., climate change effects)</li>
<li>
<strong>Seasonality</strong>: Regular cyclic patterns (e.g., annual breeding cycles)</li>
<li>
<strong>Noise</strong>: Random variation (e.g., environmental stochasticity)</li>
</ul>
</li>
<li>
<strong>Autocorrelation Functions</strong>
<ul>
<li>
<strong>ACF</strong>: Shows correlation between observations at different time lags</li>
<li>
<strong>PACF</strong>: Shows direct correlation after removing indirect effects</li>
<li>Significant spikes indicate temporal dependence</li>
</ul>
</li>
<li>
<strong>Ecological Relevance</strong>
<ul>
<li>Population dynamics often show autocorrelation due to age structure</li>
<li>Climate variables have strong seasonal patterns</li>
<li>Ignoring autocorrelation leads to invalid statistical inferences</li>
</ul>
</li>
</ol>
</div>
</div>
</section><section id="time-series-decomposition" class="level3" data-number="10.3.2"><h3 data-number="10.3.2" class="anchored" data-anchor-id="time-series-decomposition">
<span class="header-section-number">10.3.2</span> Time Series Decomposition</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Convert to ts object for decomposition</span></span>
<span><span class="va">pop_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="va">pop_ts_data</span><span class="op">$</span><span class="va">population</span>, start <span class="op">=</span> <span class="fl">1990</span>, frequency <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Decompose the time series</span></span>
<span><span class="va">decomp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/stl.html">stl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="va">pop_ts_data</span><span class="op">$</span><span class="va">population</span>, frequency <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, s.window <span class="op">=</span> <span class="st">"periodic"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot decomposition</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">decomp</span>, main <span class="op">=</span> <span class="st">"Time Series Decomposition"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># Extract components</span></span>
<span><span class="va">trend_component</span> <span class="op">&lt;-</span> <span class="va">decomp</span><span class="op">$</span><span class="va">time.series</span><span class="op">[</span>, <span class="st">"trend"</span><span class="op">]</span></span>
<span><span class="va">seasonal_component</span> <span class="op">&lt;-</span> <span class="va">decomp</span><span class="op">$</span><span class="va">time.series</span><span class="op">[</span>, <span class="st">"seasonal"</span><span class="op">]</span></span>
<span><span class="va">remainder</span> <span class="op">&lt;-</span> <span class="va">decomp</span><span class="op">$</span><span class="va">time.series</span><span class="op">[</span>, <span class="st">"remainder"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create a data frame for ggplot</span></span>
<span><span class="va">decomp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="va">years</span>,</span>
<span>  observed <span class="op">=</span> <span class="va">pop_ts_data</span><span class="op">$</span><span class="va">population</span>,</span>
<span>  trend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">trend_component</span><span class="op">)</span>,</span>
<span>  seasonal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">seasonal_component</span><span class="op">)</span>,</span>
<span>  remainder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">remainder</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize components with ggplot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="va">decomp_long</span> <span class="op">&lt;-</span> <span class="va">decomp_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">observed</span>, <span class="va">trend</span>, <span class="va">seasonal</span>, <span class="va">remainder</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"component"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">decomp_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">component</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Time Series Decomposition Components"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Value"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Results Interpretation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Time series decomposition reveals the structure of temporal data:</p>
<ol type="1">
<li>
<strong>Trend Component</strong>
<ul>
<li>Shows the long-term direction of the population</li>
<li>Increasing trend suggests population growth</li>
<li>Can be linear or non-linear</li>
<li>Important for long-term conservation planning</li>
</ul>
</li>
<li>
<strong>Seasonal Component</strong>
<ul>
<li>Reveals cyclic patterns in the data</li>
<li>In this example, shows a 5-year cycle</li>
<li>Could represent environmental cycles (e.g., El Niño)</li>
<li>Helps identify optimal monitoring times</li>
</ul>
</li>
<li>
<strong>Remainder (Residuals)</strong>
<ul>
<li>Random variation after removing trend and seasonality</li>
<li>Should be approximately white noise if decomposition is appropriate</li>
<li>Large residuals may indicate unusual events or data quality issues</li>
</ul>
</li>
<li>
<strong>Ecological Applications</strong>
<ul>
<li>Separate long-term trends from natural cycles</li>
<li>Identify critical periods in species life cycles</li>
<li>Detect anomalies or regime shifts</li>
<li>Inform sampling design for monitoring programs</li>
</ul>
</li>
</ol>
</div>
</div>
</section><section id="forecasting-with-arima-models" class="level3" data-number="10.3.3"><h3 data-number="10.3.3" class="anchored" data-anchor-id="forecasting-with-arima-models">
<span class="header-section-number">10.3.3</span> Forecasting with ARIMA Models</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit an ARIMA model</span></span>
<span><span class="co"># auto.arima selects the best model automatically</span></span>
<span><span class="va">arima_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/auto.arima.html">auto.arima</a></span><span class="op">(</span><span class="va">pop_ts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">arima_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Series: pop_ts </span></span>
<span><span class="co">#&gt; ARIMA(4,1,0) with drift </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;           ar1      ar2      ar3      ar4   drift</span></span>
<span><span class="co">#&gt;       -0.6980  -0.6483  -0.8834  -0.4754  1.8761</span></span>
<span><span class="co">#&gt; s.e.   0.1499   0.1160   0.1091   0.1491  0.3112</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; sigma^2 = 46.02:  log likelihood = -109.02</span></span>
<span><span class="co">#&gt; AIC=230.04   AICc=233.27   BIC=239.02</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Training set error measures:</span></span>
<span><span class="co">#&gt;                      ME     RMSE     MAE        MPE     MAPE      MASE</span></span>
<span><span class="co">#&gt; Training set -0.3425243 6.156046 4.88382 -0.5880105 3.756309 0.5052228</span></span>
<span><span class="co">#&gt;                     ACF1</span></span>
<span><span class="co">#&gt; Training set -0.02601765</span></span>
<span></span>
<span><span class="co"># Make forecasts for the next 5 years</span></span>
<span><span class="va">forecast_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span><span class="va">arima_model</span>, h <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the forecast</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">forecast_result</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Population Forecast (ARIMA Model)"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"5-year forecast with 80% and 95% confidence intervals"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Population Size"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># Extract forecast values</span></span>
<span><span class="va">forecast_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fl">2024</span><span class="op">:</span><span class="fl">2028</span>,</span>
<span>  point_forecast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">forecast_result</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span>,</span>
<span>  lower_80 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">forecast_result</span><span class="op">$</span><span class="va">lower</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  upper_80 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">forecast_result</span><span class="op">$</span><span class="va">upper</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  lower_95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">forecast_result</span><span class="op">$</span><span class="va">lower</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  upper_95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">forecast_result</span><span class="op">$</span><span class="va">upper</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">forecast_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year point_forecast lower_80 upper_80 lower_95 upper_95</span></span>
<span><span class="co">#&gt; 1 2024       167.6379 158.9443 176.3314 154.3422 180.9335</span></span>
<span><span class="co">#&gt; 2 2025       175.1418 166.0603 184.2232 161.2529 189.0307</span></span>
<span><span class="co">#&gt; 3 2026       173.7157 164.5521 182.8793 159.7011 187.7303</span></span>
<span><span class="co">#&gt; 4 2027       171.1390 161.8463 180.4317 156.9270 185.3509</span></span>
<span><span class="co">#&gt; 5 2028       172.9301 163.3007 182.5595 158.2032 187.6570</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
PROFESSIONAL TIP: Time Series Forecasting in Ecology
</div>
</div>
<div class="callout-body-container callout-body">
<p>When forecasting ecological time series:</p>
<ol type="1">
<li>
<strong>Model Selection</strong>
<ul>
<li>Use <code><a href="https://pkg.robjhyndman.com/forecast/reference/auto.arima.html">auto.arima()</a></code> for automatic model selection</li>
<li>Consider seasonal ARIMA for data with clear seasonality</li>
<li>Evaluate multiple models and compare AIC/BIC</li>
<li>Check residual diagnostics to validate model assumptions</li>
</ul>
</li>
<li>
<strong>Forecast Interpretation</strong>
<ul>
<li>Point forecasts are the expected values</li>
<li>Confidence intervals quantify uncertainty</li>
<li>Uncertainty increases with forecast horizon</li>
<li>Consider biological constraints (e.g., populations can’t be negative)</li>
</ul>
</li>
<li>
<strong>Ecological Considerations</strong>
<ul>
<li>Short-term forecasts are more reliable than long-term</li>
<li>Regime shifts or environmental changes can invalidate models</li>
<li>Incorporate external covariates when available (e.g., climate indices)</li>
<li>Use ensemble forecasts for robust predictions</li>
</ul>
</li>
<li>
<strong>Communication</strong>
<ul>
<li>Always show uncertainty in forecasts</li>
<li>Explain assumptions and limitations</li>
<li>Relate forecasts to management thresholds</li>
<li>Update forecasts as new data become available</li>
</ul>
</li>
</ol>
</div>
</div>
</section><section id="ecological-example-phenology-trends" class="level3" data-number="10.3.4"><h3 data-number="10.3.4" class="anchored" data-anchor-id="ecological-example-phenology-trends">
<span class="header-section-number">10.3.4</span> Ecological Example: Phenology Trends</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span>  <span class="co"># For dwtest()</span></span>
<span></span>
<span><span class="co"># Simulate phenological data (e.g., first flowering date)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">years_pheno</span> <span class="op">&lt;-</span> <span class="fl">1980</span><span class="op">:</span><span class="fl">2023</span></span>
<span><span class="va">n_years_pheno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">years_pheno</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Earlier flowering over time due to climate change</span></span>
<span><span class="va">flowering_doy</span> <span class="op">&lt;-</span> <span class="fl">120</span> <span class="op">-</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_years_pheno</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n_years_pheno</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pheno_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="va">years_pheno</span>,</span>
<span>  flowering_day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">flowering_doy</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize the trend</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">pheno_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">flowering_day</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, color <span class="op">=</span> <span class="st">"red"</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Phenological Shift: First Flowering Date"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Earlier flowering over time suggests climate warming"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Day of Year (First Flowering)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-advanced-modeling_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># Fit a linear model to quantify the trend</span></span>
<span><span class="va">pheno_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">flowering_day</span> <span class="op">~</span> <span class="va">year</span>, data <span class="op">=</span> <span class="va">pheno_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pheno_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = flowering_day ~ year, data = pheno_data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -5.7254 -1.6662 -0.2123  1.7907  6.1424 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 719.0325    66.8573  10.755 1.22e-13 ***</span></span>
<span><span class="co">#&gt; year         -0.3026     0.0334  -9.059 1.97e-11 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 2.814 on 42 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.6615, Adjusted R-squared:  0.6534 </span></span>
<span><span class="co">#&gt; F-statistic: 82.07 on 1 and 42 DF,  p-value: 1.967e-11</span></span>
<span></span>
<span><span class="co"># Calculate the rate of change</span></span>
<span><span class="va">rate_per_decade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">pheno_model</span><span class="op">)</span><span class="op">[</span><span class="st">"year"</span><span class="op">]</span> <span class="op">*</span> <span class="fl">10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Flowering is occurring %.2f days earlier per decade\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">rate_per_decade</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Flowering is occurring 3.03 days earlier per decade</span></span>
<span></span>
<span><span class="co"># Test for autocorrelation in residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/dwtest.html">dwtest</a></span><span class="op">(</span><span class="va">pheno_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Durbin-Watson test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  pheno_model</span></span>
<span><span class="co">#&gt; DW = 1.9126, p-value = 0.3252</span></span>
<span><span class="co">#&gt; alternative hypothesis: true autocorrelation is greater than 0</span></span>
<span></span>
<span><span class="co"># If autocorrelation is present, use GLS</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span></span>
<span><span class="va">gls_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/gls.html">gls</a></span><span class="op">(</span><span class="va">flowering_day</span> <span class="op">~</span> <span class="va">year</span>,</span>
<span>                 correlation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/corAR1.html">corAR1</a></span><span class="op">(</span>form <span class="op">=</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">pheno_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gls_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generalized least squares fit by REML</span></span>
<span><span class="co">#&gt;   Model: flowering_day ~ year </span></span>
<span><span class="co">#&gt;   Data: pheno_data </span></span>
<span><span class="co">#&gt;        AIC      BIC  logLik</span></span>
<span><span class="co">#&gt;   226.6999 233.6506 -109.35</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation Structure: AR(1)</span></span>
<span><span class="co">#&gt;  Formula: ~year </span></span>
<span><span class="co">#&gt;  Parameter estimate(s):</span></span>
<span><span class="co">#&gt;        Phi </span></span>
<span><span class="co">#&gt; 0.03243688 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                Value Std.Error   t-value p-value</span></span>
<span><span class="co">#&gt; (Intercept) 717.3361  69.01309 10.394204       0</span></span>
<span><span class="co">#&gt; year         -0.3018   0.03448 -8.751694       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Correlation: </span></span>
<span><span class="co">#&gt;      (Intr)</span></span>
<span><span class="co">#&gt; year -1    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Standardized residuals:</span></span>
<span><span class="co">#&gt;         Min          Q1         Med          Q3         Max </span></span>
<span><span class="co">#&gt; -2.03150156 -0.59213522 -0.07665248  0.63090321  2.17206766 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 2.818014 </span></span>
<span><span class="co">#&gt; Degrees of freedom: 44 total; 42 residual</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Phenological Trends and Climate Change
</div>
</div>
<div class="callout-body-container callout-body">
<p>Phenological shifts provide powerful evidence of climate change impacts:</p>
<ol type="1">
<li>
<strong>Trend Detection</strong>
<ul>
<li>Linear regression can detect long-term trends</li>
<li>Rate of change quantifies the magnitude of shifts</li>
<li>Statistical significance indicates confidence in the trend</li>
</ul>
</li>
<li>
<strong>Temporal Autocorrelation</strong>
<ul>
<li>Phenological data often show autocorrelation</li>
<li>Durbin-Watson test detects autocorrelation in residuals</li>
<li>Generalized Least Squares (GLS) accounts for autocorrelation</li>
<li>Proper modeling prevents inflated Type I error rates</li>
</ul>
</li>
<li>
<strong>Ecological Implications</strong>
<ul>
<li>Earlier flowering can lead to phenological mismatches</li>
<li>Pollinators may not be active when plants flower</li>
<li>Affects reproductive success and population dynamics</li>
<li>Indicates ecosystem-wide climate change responses</li>
</ul>
</li>
<li>
<strong>Conservation Applications</strong>
<ul>
<li>Monitor phenological shifts as climate change indicators</li>
<li>Identify species vulnerable to phenological mismatches</li>
<li>Inform assisted migration decisions</li>
<li>Guide adaptive management strategies</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code Explanation
</div>
</div>
<div class="callout-body-container callout-body">
<p>The phenology example demonstrates practical time series analysis:</p>
<ol type="1">
<li>
<strong>Trend Analysis</strong>
<ul>
<li>Linear regression quantifies the rate of phenological shift</li>
<li>Confidence intervals indicate precision of the estimate</li>
<li>Visual inspection confirms the trend pattern</li>
</ul>
</li>
<li>
<strong>Autocorrelation Testing</strong>
<ul>
<li>Durbin-Watson test checks for temporal autocorrelation</li>
<li>Significant autocorrelation requires specialized models</li>
<li>GLS with AR(1) correlation structure accounts for autocorrelation</li>
</ul>
</li>
<li>
<strong>Model Comparison</strong>
<ul>
<li>Compare standard linear model with GLS</li>
<li>GLS provides more accurate standard errors</li>
<li>Prevents false positives in trend detection</li>
</ul>
</li>
</ol>
</div>
</div>
<p>Time series analysis is essential for understanding temporal dynamics in ecological systems. By properly accounting for temporal structure, we can detect trends, make forecasts, and understand how ecosystems respond to environmental change.</p>
</section></section><section id="chapter-summary" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="chapter-summary">
<span class="header-section-number">10.4</span> Chapter Summary</h2>
<section id="key-concepts" class="level3" data-number="10.4.1"><h3 data-number="10.4.1" class="anchored" data-anchor-id="key-concepts">
<span class="header-section-number">10.4.1</span> Key Concepts</h3>
<ul>
<li>
<strong>Model Interpretation</strong>: DALEX framework provides model-agnostic interpretation methods</li>
<li>
<strong>Variable Importance</strong>: Permutation importance quantifies predictor contributions</li>
<li>
<strong>Partial Dependence</strong>: Shows average marginal effects of predictors</li>
<li>
<strong>ICE Plots</strong>: Reveal individual-level heterogeneity in predictions</li>
<li>
<strong>SHAP Values</strong>: Provide fair attribution of predictions to features</li>
<li>
<strong>Temporal Autocorrelation</strong>: Nearby time points are often correlated</li>
<li>
<strong>Time Series Decomposition</strong>: Separates trend, seasonal, and noise components</li>
<li>
<strong>ARIMA Models</strong>: Flexible framework for time series forecasting</li>
<li>
<strong>GLS Models</strong>: Account for temporal autocorrelation in regression</li>
</ul></section><section id="r-functions-learned" class="level3" data-number="10.4.2"><h3 data-number="10.4.2" class="anchored" data-anchor-id="r-functions-learned">
<span class="header-section-number">10.4.2</span> R Functions Learned</h3>
<ul>
<li>
<code><a href="https://ModelOriented.github.io/DALEXtra/reference/explain_tidymodels.html">explain_tidymodels()</a></code> - Create DALEX explainer for tidymodels</li>
<li>
<code><a href="https://modeloriented.github.io/DALEX/reference/model_parts.html">model_parts()</a></code> - Calculate variable importance</li>
<li>
<code><a href="https://modeloriented.github.io/DALEX/reference/model_profile.html">model_profile()</a></code> - Create partial dependence and ICE plots</li>
<li>
<code><a href="https://modeloriented.github.io/DALEX/reference/predict_parts.html">predict_parts()</a></code> - Explain individual predictions</li>
<li>
<code><a href="https://pkg.robjhyndman.com/forecast/reference/auto.arima.html">auto.arima()</a></code> - Automatic ARIMA model selection</li>
<li>
<code><a href="https://generics.r-lib.org/reference/forecast.html">forecast()</a></code> - Generate forecasts ## Introduction</li>
</ul>
<p>This chapter explores advanced modeling techniques that extend beyond traditional regression (covered in <a href="../chapters/08-regression.html">Chapter 8</a>). We’ll cover model interpretation methods that help us understand “black box” machine learning models, and time series analysis for data collected sequentially over time.</p>
</section><section id="next-steps" class="level3" data-number="10.4.3"><h3 data-number="10.4.3" class="anchored" data-anchor-id="next-steps">
<span class="header-section-number">10.4.3</span> Next Steps</h3>
<p>Congratulations on completing <em>Data Analysis in Natural Sciences</em>! You now possess a comprehensive toolkit for analyzing ecological data, from data cleaning and visualization to advanced modeling and interpretation.</p>
<p>To continue your journey: - Apply these techniques to your own datasets - Explore the documentation for packages like <code>tidymodels</code>, <code>DALEX</code>, and <code>fable</code> - Join the R for Data Science community to keep learning - Contribute to open-source projects in ecology and conservation</p>
<p>For applied examples in conservation science, check out <a href="../chapters/10-conservation.html">Chapter 10: Conservation Applications</a>.</p>
</section></section><section id="exercises" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">10.5</span> Exercises</h2>
<ol type="1">
<li><p><strong>Model Interpretation</strong>: Use DALEX to interpret a random forest model predicting species abundance. Which environmental variables are most important?</p></li>
<li><p><strong>Partial Dependence</strong>: Create partial dependence plots for the top 3 most important variables. Do the relationships make ecological sense?</p></li>
<li><p><strong>Individual Predictions</strong>: Select an unusual prediction (outlier) and use SHAP values to explain why the model made that prediction.</p></li>
<li><p><strong>Time Series Decomposition</strong>: Analyze a real ecological time series (e.g., population counts, temperature data). Decompose it and interpret the components.</p></li>
<li><p><strong>ARIMA Forecasting</strong>: Build an ARIMA model for a population time series. How far into the future can you reliably forecast?</p></li>
<li><p><strong>Phenology Analysis</strong>: Analyze phenological data (e.g., bird arrival dates, flowering times) for evidence of climate change. Account for temporal autocorrelation.</p></li>
<li><p><strong>Model Comparison</strong>: Compare interpretations from different ML models (random forest, gradient boosting, neural network) on the same dataset. Do they agree on variable importance?</p></li>
<li><p><strong>Ensemble Interpretation</strong>: Create an ensemble model and interpret it. How does the interpretation differ from individual models?</p></li>
</ol>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("^(?:http:|https:)\/\/jm0535\.github\.io\/dains");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/08-regression.html" class="pagination-link" aria-label="Regression Analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Regression Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/10-conservation.html" class="pagination-link" aria-label="Conservation Applications">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Conservation Applications</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb18" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="an">prefer-html:</span><span class="co"> true</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Advanced Modeling Techniques {#sec-advanced-modeling}</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>By the end of this chapter, you will be able to:</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Interpret machine learning models using model-agnostic methods</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Calculate and visualize variable importance</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Create partial dependence and ICE plots</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Explain individual predictions with SHAP values</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Analyze time series data with temporal autocorrelation</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Decompose time series into trend, seasonal, and noise components</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Build ARIMA models for forecasting</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Account for temporal autocorrelation in regression models</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>This chapter explores advanced modeling techniques that extend beyond traditional regression. We'll cover model interpretation methods that help us understand "black box" machine learning models, and time series analysis for data collected sequentially over time.</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Interpretation and Explainability</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>While machine learning models like Random Forest can achieve high predictive accuracy, understanding *why* they make specific predictions is crucial for ecological applications. Model interpretation helps us extract ecological insights and communicate results to stakeholders.</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="fu">### Variable Importance</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages for model interpretation</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DALEX)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DALEXtra)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the penguins data (same as chapter 08)</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins <span class="sc">%&gt;%</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into training and testing sets</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>penguin_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(penguins, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata =</span> species)</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>penguin_train <span class="ot">&lt;-</span> <span class="fu">training</span>(penguin_split)</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>penguin_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(penguin_split)</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a recipe for preprocessing</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>penguin_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>                         flipper_length_mm <span class="sc">+</span> species,</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> penguin_train) <span class="sc">%&gt;%</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Random Forest model specification</span></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">trees =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workflow</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>rf_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(penguin_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_spec)</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the final model</span></span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>final_fit <span class="ot">&lt;-</span> rf_wf <span class="sc">%&gt;%</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> penguin_train)</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an explainer object</span></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>explainer_rf <span class="ot">&lt;-</span> <span class="fu">explain_tidymodels</span>(</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>  final_fit,</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> penguin_test <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>body_mass_g),</span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> penguin_test<span class="sc">$</span>body_mass_g,</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"Random Forest"</span>,</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate variable importance using permutation</span></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>vi_rf <span class="ot">&lt;-</span> <span class="fu">model_parts</span>(explainer_rf, <span class="at">loss_function =</span> loss_root_mean_square)</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize variable importance</span></span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vi_rf) <span class="sc">+</span></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Variable Importance for Body Mass Prediction"</span>,</span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Permutation-based importance shows contribution of each predictor"</span>) <span class="sc">+</span></span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the importance values</span></span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>vi_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(vi_rf)</span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>vi_summary <span class="ot">&lt;-</span> vi_df <span class="sc">%&gt;%</span></span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">!=</span> <span class="st">"_baseline_"</span>, variable <span class="sc">!=</span> <span class="st">"_full_model_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_dropout_loss =</span> <span class="fu">mean</span>(dropout_loss),</span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_dropout_loss))</span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vi_summary)</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a><span class="fu">## Code Explanation</span></span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>This code demonstrates model-agnostic variable importance:</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**DALEX Framework**</span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Creates an "explainer" object that wraps the tidymodels workflow</span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Provides a unified interface for model interpretation</span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Works with any model type (linear, tree-based, neural networks)</span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Permutation Importance**</span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Measures how much model performance decreases when a variable is randomly shuffled</span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Higher dropout loss = more important variable</span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Unlike tree-based importance, this works for any model and accounts for correlations</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Interpretation**</span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Variables are ranked by their contribution to predictions</span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Helps identify which morphological features are most predictive of body mass</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Provides ecological insights into species morphology</span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a><span class="fu">### Partial Dependence Plots</span></span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a>Partial dependence plots show how predictions change as a single variable varies, while averaging over all other variables.</span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Create partial dependence profiles for key variables</span></span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a>pdp_flipper <span class="ot">&lt;-</span> <span class="fu">model_profile</span>(</span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>  explainer_rf,</span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"flipper_length_mm"</span>,</span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="cn">NULL</span>  <span class="co"># Use all observations</span></span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a>pdp_bill <span class="ot">&lt;-</span> <span class="fu">model_profile</span>(</span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>  explainer_rf,</span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"bill_length_mm"</span>,</span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="cn">NULL</span></span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot partial dependence</span></span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pdp_flipper) <span class="sc">+</span></span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Partial Dependence: Flipper Length"</span>,</span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Shows average effect of flipper length on predicted body mass"</span>,</span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Body Mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pdp_bill) <span class="sc">+</span></span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Partial Dependence: Bill Length"</span>,</span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Shows average effect of bill length on predicted body mass"</span>,</span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bill Length (mm)"</span>,</span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Body Mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 2D partial dependence plot for interactions</span></span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>pdp_2d <span class="ot">&lt;-</span> <span class="fu">model_profile</span>(</span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>  explainer_rf,</span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"flipper_length_mm"</span>, <span class="st">"bill_length_mm"</span>),</span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">100</span></span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: 2D plots require additional processing</span></span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a><span class="co"># For simplicity, we'll show individual effects</span></span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-175"><a href="#cb18-175" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb18-176"><a href="#cb18-176" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results Interpretation</span></span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a>Partial dependence plots reveal important ecological relationships:</span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Marginal Effects**</span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Shows how each predictor affects the response on average</span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Accounts for correlations between predictors</span>
<span id="cb18-183"><a href="#cb18-183" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Reveals non-linear relationships that linear models would miss</span>
<span id="cb18-184"><a href="#cb18-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-185"><a href="#cb18-185" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Ecological Insights**</span>
<span id="cb18-186"><a href="#cb18-186" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Flipper length typically shows a strong positive relationship with body mass</span>
<span id="cb18-187"><a href="#cb18-187" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>The relationship may be non-linear (e.g., diminishing returns at large sizes)</span>
<span id="cb18-188"><a href="#cb18-188" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Different species may show different patterns (captured by species variable)</span>
<span id="cb18-189"><a href="#cb18-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-190"><a href="#cb18-190" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Model Behavior**</span>
<span id="cb18-191"><a href="#cb18-191" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Helps validate that the model learned sensible relationships</span>
<span id="cb18-192"><a href="#cb18-192" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Can reveal unexpected patterns that warrant further investigation</span>
<span id="cb18-193"><a href="#cb18-193" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Useful for communicating model predictions to non-technical audiences</span>
<span id="cb18-194"><a href="#cb18-194" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-195"><a href="#cb18-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-196"><a href="#cb18-196" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual Conditional Expectation (ICE) Plots</span></span>
<span id="cb18-197"><a href="#cb18-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-198"><a href="#cb18-198" aria-hidden="true" tabindex="-1"></a>While partial dependence shows average effects, ICE plots show how predictions change for individual observations.</span>
<span id="cb18-199"><a href="#cb18-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-202"><a href="#cb18-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-203"><a href="#cb18-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Create ICE plots for flipper length</span></span>
<span id="cb18-204"><a href="#cb18-204" aria-hidden="true" tabindex="-1"></a>ice_flipper <span class="ot">&lt;-</span> <span class="fu">model_profile</span>(</span>
<span id="cb18-205"><a href="#cb18-205" aria-hidden="true" tabindex="-1"></a>  explainer_rf,</span>
<span id="cb18-206"><a href="#cb18-206" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"flipper_length_mm"</span>,</span>
<span id="cb18-207"><a href="#cb18-207" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">50</span>,  <span class="co"># Use 50 observations for clarity</span></span>
<span id="cb18-208"><a href="#cb18-208" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"conditional"</span></span>
<span id="cb18-209"><a href="#cb18-209" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-210"><a href="#cb18-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-211"><a href="#cb18-211" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ICE curves</span></span>
<span id="cb18-212"><a href="#cb18-212" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ice_flipper) <span class="sc">+</span></span>
<span id="cb18-213"><a href="#cb18-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Individual Conditional Expectation: Flipper Length"</span>,</span>
<span id="cb18-214"><a href="#cb18-214" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Each line shows how prediction changes for one penguin"</span>,</span>
<span id="cb18-215"><a href="#cb18-215" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span id="cb18-216"><a href="#cb18-216" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Body Mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb18-217"><a href="#cb18-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-218"><a href="#cb18-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare with partial dependence (average)</span></span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ice_flipper, <span class="at">geom =</span> <span class="st">"profiles"</span>) <span class="sc">+</span></span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ICE Plots with Partial Dependence (yellow line)"</span>,</span>
<span id="cb18-222"><a href="#cb18-222" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Individual effects vs. average effect"</span>,</span>
<span id="cb18-223"><a href="#cb18-223" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span id="cb18-224"><a href="#cb18-224" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Body Mass (g)"</span>) <span class="sc">+</span></span>
<span id="cb18-225"><a href="#cb18-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-226"><a href="#cb18-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-227"><a href="#cb18-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-228"><a href="#cb18-228" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb18-229"><a href="#cb18-229" aria-hidden="true" tabindex="-1"></a><span class="fu">## PROFESSIONAL TIP: Choosing Interpretation Methods</span></span>
<span id="cb18-230"><a href="#cb18-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-231"><a href="#cb18-231" aria-hidden="true" tabindex="-1"></a>When interpreting machine learning models for ecological applications:</span>
<span id="cb18-232"><a href="#cb18-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-233"><a href="#cb18-233" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Variable Importance**</span>
<span id="cb18-234"><a href="#cb18-234" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Use permutation importance for model-agnostic assessment</span>
<span id="cb18-235"><a href="#cb18-235" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Compare with domain knowledge to validate model behavior</span>
<span id="cb18-236"><a href="#cb18-236" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Consider both statistical and ecological importance</span>
<span id="cb18-237"><a href="#cb18-237" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Report confidence intervals when possible</span>
<span id="cb18-238"><a href="#cb18-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-239"><a href="#cb18-239" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Partial Dependence Plots**</span>
<span id="cb18-240"><a href="#cb18-240" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Show average marginal effects of predictors</span>
<span id="cb18-241"><a href="#cb18-241" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Useful for understanding overall patterns</span>
<span id="cb18-242"><a href="#cb18-242" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Can mask heterogeneous effects across observations</span>
<span id="cb18-243"><a href="#cb18-243" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Best for communicating general relationships</span>
<span id="cb18-244"><a href="#cb18-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-245"><a href="#cb18-245" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**ICE Plots**</span>
<span id="cb18-246"><a href="#cb18-246" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Reveal individual-level heterogeneity</span>
<span id="cb18-247"><a href="#cb18-247" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Identify subgroups with different response patterns</span>
<span id="cb18-248"><a href="#cb18-248" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>More complex to interpret than PDP</span>
<span id="cb18-249"><a href="#cb18-249" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Useful for detecting interactions</span>
<span id="cb18-250"><a href="#cb18-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-251"><a href="#cb18-251" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Break-Down Plots** (for individual predictions)</span>
<span id="cb18-252"><a href="#cb18-252" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Explain specific predictions step-by-step</span>
<span id="cb18-253"><a href="#cb18-253" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Useful for understanding outliers or unusual cases</span>
<span id="cb18-254"><a href="#cb18-254" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Helps build trust in model predictions</span>
<span id="cb18-255"><a href="#cb18-255" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Essential for high-stakes conservation decisions</span>
<span id="cb18-256"><a href="#cb18-256" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-257"><a href="#cb18-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-258"><a href="#cb18-258" aria-hidden="true" tabindex="-1"></a><span class="fu">### Explaining Individual Predictions</span></span>
<span id="cb18-259"><a href="#cb18-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-260"><a href="#cb18-260" aria-hidden="true" tabindex="-1"></a>For specific conservation decisions, we often need to understand why the model made a particular prediction.</span>
<span id="cb18-261"><a href="#cb18-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-264"><a href="#cb18-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-265"><a href="#cb18-265" aria-hidden="true" tabindex="-1"></a><span class="co"># Select an interesting observation to explain</span></span>
<span id="cb18-266"><a href="#cb18-266" aria-hidden="true" tabindex="-1"></a>observation_to_explain <span class="ot">&lt;-</span> penguin_test[<span class="dv">1</span>, ]</span>
<span id="cb18-267"><a href="#cb18-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-268"><a href="#cb18-268" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Explaining prediction for:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-269"><a href="#cb18-269" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(observation_to_explain <span class="sc">%&gt;%</span> <span class="fu">select</span>(species, bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g))</span>
<span id="cb18-270"><a href="#cb18-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-271"><a href="#cb18-271" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a break-down explanation</span></span>
<span id="cb18-272"><a href="#cb18-272" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">predict_parts</span>(</span>
<span id="cb18-273"><a href="#cb18-273" aria-hidden="true" tabindex="-1"></a>  explainer_rf,</span>
<span id="cb18-274"><a href="#cb18-274" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_observation =</span> observation_to_explain,</span>
<span id="cb18-275"><a href="#cb18-275" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"break_down"</span></span>
<span id="cb18-276"><a href="#cb18-276" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-277"><a href="#cb18-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-278"><a href="#cb18-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the break-down</span></span>
<span id="cb18-279"><a href="#cb18-279" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bd) <span class="sc">+</span></span>
<span id="cb18-280"><a href="#cb18-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Break-Down Plot for Individual Prediction"</span>,</span>
<span id="cb18-281"><a href="#cb18-281" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Shows contribution of each variable to the final prediction"</span>) <span class="sc">+</span></span>
<span id="cb18-282"><a href="#cb18-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-283"><a href="#cb18-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-284"><a href="#cb18-284" aria-hidden="true" tabindex="-1"></a><span class="co"># Create SHAP values for more robust attribution</span></span>
<span id="cb18-285"><a href="#cb18-285" aria-hidden="true" tabindex="-1"></a>shap <span class="ot">&lt;-</span> <span class="fu">predict_parts</span>(</span>
<span id="cb18-286"><a href="#cb18-286" aria-hidden="true" tabindex="-1"></a>  explainer_rf,</span>
<span id="cb18-287"><a href="#cb18-287" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_observation =</span> observation_to_explain,</span>
<span id="cb18-288"><a href="#cb18-288" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"shap"</span>,</span>
<span id="cb18-289"><a href="#cb18-289" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">25</span>  <span class="co"># Number of random orderings</span></span>
<span id="cb18-290"><a href="#cb18-290" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-291"><a href="#cb18-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-292"><a href="#cb18-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot SHAP values</span></span>
<span id="cb18-293"><a href="#cb18-293" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(shap) <span class="sc">+</span></span>
<span id="cb18-294"><a href="#cb18-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SHAP Values for Individual Prediction"</span>,</span>
<span id="cb18-295"><a href="#cb18-295" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Average contribution across all possible variable orderings"</span>) <span class="sc">+</span></span>
<span id="cb18-296"><a href="#cb18-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-297"><a href="#cb18-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-298"><a href="#cb18-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-299"><a href="#cb18-299" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb18-300"><a href="#cb18-300" aria-hidden="true" tabindex="-1"></a><span class="fu">## Code Explanation</span></span>
<span id="cb18-301"><a href="#cb18-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-302"><a href="#cb18-302" aria-hidden="true" tabindex="-1"></a>Individual prediction explanations help understand specific cases:</span>
<span id="cb18-303"><a href="#cb18-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-304"><a href="#cb18-304" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Break-Down Plots**</span>
<span id="cb18-305"><a href="#cb18-305" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Show step-by-step how each variable contributes to the prediction</span>
<span id="cb18-306"><a href="#cb18-306" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Start from the average prediction and add each variable's effect</span>
<span id="cb18-307"><a href="#cb18-307" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Order matters: variables are added in order of importance</span>
<span id="cb18-308"><a href="#cb18-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-309"><a href="#cb18-309" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**SHAP Values**</span>
<span id="cb18-310"><a href="#cb18-310" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Shapley Additive exPlanations from game theory</span>
<span id="cb18-311"><a href="#cb18-311" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Average contribution across all possible orderings of variables</span>
<span id="cb18-312"><a href="#cb18-312" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>More robust than break-down plots but computationally intensive</span>
<span id="cb18-313"><a href="#cb18-313" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Provides fair attribution of prediction to each feature</span>
<span id="cb18-314"><a href="#cb18-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-315"><a href="#cb18-315" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Ecological Applications**</span>
<span id="cb18-316"><a href="#cb18-316" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Explain why a particular species is predicted in a certain location</span>
<span id="cb18-317"><a href="#cb18-317" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Understand which factors drive high/low abundance predictions</span>
<span id="cb18-318"><a href="#cb18-318" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Communicate model reasoning to stakeholders and decision-makers</span>
<span id="cb18-319"><a href="#cb18-319" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Identify data quality issues or model failures</span>
<span id="cb18-320"><a href="#cb18-320" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-321"><a href="#cb18-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-322"><a href="#cb18-322" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb18-323"><a href="#cb18-323" aria-hidden="true" tabindex="-1"></a><span class="fu">## Communicating ML Results in Ecology</span></span>
<span id="cb18-324"><a href="#cb18-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-325"><a href="#cb18-325" aria-hidden="true" tabindex="-1"></a>When presenting machine learning results to ecological audiences:</span>
<span id="cb18-326"><a href="#cb18-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-327"><a href="#cb18-327" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Focus on Ecological Meaning**</span>
<span id="cb18-328"><a href="#cb18-328" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Translate statistical importance to ecological significance</span>
<span id="cb18-329"><a href="#cb18-329" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Connect model patterns to known ecological processes</span>
<span id="cb18-330"><a href="#cb18-330" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Discuss biological plausibility of relationships</span>
<span id="cb18-331"><a href="#cb18-331" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Relate findings to conservation implications</span>
<span id="cb18-332"><a href="#cb18-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-333"><a href="#cb18-333" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Visualize Effectively**</span>
<span id="cb18-334"><a href="#cb18-334" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Use partial dependence plots for main effects</span>
<span id="cb18-335"><a href="#cb18-335" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Show uncertainty in predictions</span>
<span id="cb18-336"><a href="#cb18-336" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Include actual data points alongside model predictions</span>
<span id="cb18-337"><a href="#cb18-337" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Use colors and labels that resonate with ecological context</span>
<span id="cb18-338"><a href="#cb18-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-339"><a href="#cb18-339" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Acknowledge Limitations**</span>
<span id="cb18-340"><a href="#cb18-340" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Discuss what the model cannot capture (e.g., biotic interactions)</span>
<span id="cb18-341"><a href="#cb18-341" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Explain extrapolation risks</span>
<span id="cb18-342"><a href="#cb18-342" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Mention data quality and sampling bias issues</span>
<span id="cb18-343"><a href="#cb18-343" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Suggest validation approaches</span>
<span id="cb18-344"><a href="#cb18-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-345"><a href="#cb18-345" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Provide Actionable Insights**</span>
<span id="cb18-346"><a href="#cb18-346" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Link predictions to management recommendations</span>
<span id="cb18-347"><a href="#cb18-347" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Identify key variables that can be monitored or manipulated</span>
<span id="cb18-348"><a href="#cb18-348" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Suggest priority areas for conservation action</span>
<span id="cb18-349"><a href="#cb18-349" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Propose adaptive management strategies based on model uncertainty</span>
<span id="cb18-350"><a href="#cb18-350" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-351"><a href="#cb18-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-352"><a href="#cb18-352" aria-hidden="true" tabindex="-1"></a>Model interpretation transforms "black box" machine learning into a tool for ecological understanding. By explaining how models make predictions, we gain insights into ecological processes and build confidence in using ML for conservation decision-making.</span>
<span id="cb18-353"><a href="#cb18-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-354"><a href="#cb18-354" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time Series Analysis for Ecological Data</span></span>
<span id="cb18-355"><a href="#cb18-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-356"><a href="#cb18-356" aria-hidden="true" tabindex="-1"></a>Time series data—observations collected sequentially over time—are common in ecology. Population counts, climate measurements, and phenological observations all have temporal structure that standard regression methods cannot properly handle.</span>
<span id="cb18-357"><a href="#cb18-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-358"><a href="#cb18-358" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Temporal Autocorrelation</span></span>
<span id="cb18-359"><a href="#cb18-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-362"><a href="#cb18-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-363"><a href="#cb18-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb18-364"><a href="#cb18-364" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb18-365"><a href="#cb18-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-366"><a href="#cb18-366" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages for time series analysis</span></span>
<span id="cb18-367"><a href="#cb18-367" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb18-368"><a href="#cb18-368" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb18-369"><a href="#cb18-369" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(feasts)</span>
<span id="cb18-370"><a href="#cb18-370" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-371"><a href="#cb18-371" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb18-372"><a href="#cb18-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-373"><a href="#cb18-373" aria-hidden="true" tabindex="-1"></a><span class="co"># Create simulated population time series</span></span>
<span id="cb18-374"><a href="#cb18-374" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2024</span>)</span>
<span id="cb18-375"><a href="#cb18-375" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">1990</span><span class="sc">:</span><span class="dv">2023</span></span>
<span id="cb18-376"><a href="#cb18-376" aria-hidden="true" tabindex="-1"></a>n_years <span class="ot">&lt;-</span> <span class="fu">length</span>(years)</span>
<span id="cb18-377"><a href="#cb18-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-378"><a href="#cb18-378" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate population with trend, seasonality, and noise</span></span>
<span id="cb18-379"><a href="#cb18-379" aria-hidden="true" tabindex="-1"></a>trend <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span>n_years)  <span class="co"># Increasing trend</span></span>
<span id="cb18-380"><a href="#cb18-380" aria-hidden="true" tabindex="-1"></a>seasonal <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span>n_years) <span class="sc">/</span> <span class="dv">5</span>)  <span class="co"># 5-year cycle</span></span>
<span id="cb18-381"><a href="#cb18-381" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_years, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb18-382"><a href="#cb18-382" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> trend <span class="sc">+</span> seasonal <span class="sc">+</span> noise</span>
<span id="cb18-383"><a href="#cb18-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-384"><a href="#cb18-384" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time series data frame</span></span>
<span id="cb18-385"><a href="#cb18-385" aria-hidden="true" tabindex="-1"></a>pop_ts_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-386"><a href="#cb18-386" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> years,</span>
<span id="cb18-387"><a href="#cb18-387" aria-hidden="true" tabindex="-1"></a>  <span class="at">population =</span> <span class="fu">round</span>(population)</span>
<span id="cb18-388"><a href="#cb18-388" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-389"><a href="#cb18-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-390"><a href="#cb18-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the time series</span></span>
<span id="cb18-391"><a href="#cb18-391" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pop_ts_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> population)) <span class="sc">+</span></span>
<span id="cb18-392"><a href="#cb18-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-393"><a href="#cb18-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-394"><a href="#cb18-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-395"><a href="#cb18-395" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Simulated Population Time Series"</span>,</span>
<span id="cb18-396"><a href="#cb18-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Shows trend and cyclic pattern typical of ecological data"</span>,</span>
<span id="cb18-397"><a href="#cb18-397" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb18-398"><a href="#cb18-398" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Population Size"</span></span>
<span id="cb18-399"><a href="#cb18-399" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-400"><a href="#cb18-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-401"><a href="#cb18-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-402"><a href="#cb18-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for temporal autocorrelation</span></span>
<span id="cb18-403"><a href="#cb18-403" aria-hidden="true" tabindex="-1"></a><span class="co"># Create ACF and PACF plots</span></span>
<span id="cb18-404"><a href="#cb18-404" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb18-405"><a href="#cb18-405" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(pop_ts_data<span class="sc">$</span>population, <span class="at">main =</span> <span class="st">"Autocorrelation Function (ACF)"</span>)</span>
<span id="cb18-406"><a href="#cb18-406" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(pop_ts_data<span class="sc">$</span>population, <span class="at">main =</span> <span class="st">"Partial Autocorrelation Function (PACF)"</span>)</span>
<span id="cb18-407"><a href="#cb18-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-408"><a href="#cb18-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-409"><a href="#cb18-409" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb18-410"><a href="#cb18-410" aria-hidden="true" tabindex="-1"></a><span class="fu">## Code Explanation</span></span>
<span id="cb18-411"><a href="#cb18-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-412"><a href="#cb18-412" aria-hidden="true" tabindex="-1"></a>This code introduces time series concepts for ecological data:</span>
<span id="cb18-413"><a href="#cb18-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-414"><a href="#cb18-414" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Time Series Components**</span>
<span id="cb18-415"><a href="#cb18-415" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Trend**: Long-term increase or decrease (e.g., climate change effects)</span>
<span id="cb18-416"><a href="#cb18-416" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Seasonality**: Regular cyclic patterns (e.g., annual breeding cycles)</span>
<span id="cb18-417"><a href="#cb18-417" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**Noise**: Random variation (e.g., environmental stochasticity)</span>
<span id="cb18-418"><a href="#cb18-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-419"><a href="#cb18-419" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Autocorrelation Functions**</span>
<span id="cb18-420"><a href="#cb18-420" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**ACF**: Shows correlation between observations at different time lags</span>
<span id="cb18-421"><a href="#cb18-421" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>**PACF**: Shows direct correlation after removing indirect effects</span>
<span id="cb18-422"><a href="#cb18-422" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Significant spikes indicate temporal dependence</span>
<span id="cb18-423"><a href="#cb18-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-424"><a href="#cb18-424" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Ecological Relevance**</span>
<span id="cb18-425"><a href="#cb18-425" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Population dynamics often show autocorrelation due to age structure</span>
<span id="cb18-426"><a href="#cb18-426" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Climate variables have strong seasonal patterns</span>
<span id="cb18-427"><a href="#cb18-427" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Ignoring autocorrelation leads to invalid statistical inferences</span>
<span id="cb18-428"><a href="#cb18-428" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-429"><a href="#cb18-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-430"><a href="#cb18-430" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time Series Decomposition</span></span>
<span id="cb18-431"><a href="#cb18-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-434"><a href="#cb18-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-435"><a href="#cb18-435" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to ts object for decomposition</span></span>
<span id="cb18-436"><a href="#cb18-436" aria-hidden="true" tabindex="-1"></a>pop_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(pop_ts_data<span class="sc">$</span>population, <span class="at">start =</span> <span class="dv">1990</span>, <span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb18-437"><a href="#cb18-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-438"><a href="#cb18-438" aria-hidden="true" tabindex="-1"></a><span class="co"># Decompose the time series</span></span>
<span id="cb18-439"><a href="#cb18-439" aria-hidden="true" tabindex="-1"></a>decomp <span class="ot">&lt;-</span> <span class="fu">stl</span>(<span class="fu">ts</span>(pop_ts_data<span class="sc">$</span>population, <span class="at">frequency =</span> <span class="dv">5</span>), <span class="at">s.window =</span> <span class="st">"periodic"</span>)</span>
<span id="cb18-440"><a href="#cb18-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-441"><a href="#cb18-441" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot decomposition</span></span>
<span id="cb18-442"><a href="#cb18-442" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(decomp, <span class="at">main =</span> <span class="st">"Time Series Decomposition"</span>)</span>
<span id="cb18-443"><a href="#cb18-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-444"><a href="#cb18-444" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract components</span></span>
<span id="cb18-445"><a href="#cb18-445" aria-hidden="true" tabindex="-1"></a>trend_component <span class="ot">&lt;-</span> decomp<span class="sc">$</span>time.series[, <span class="st">"trend"</span>]</span>
<span id="cb18-446"><a href="#cb18-446" aria-hidden="true" tabindex="-1"></a>seasonal_component <span class="ot">&lt;-</span> decomp<span class="sc">$</span>time.series[, <span class="st">"seasonal"</span>]</span>
<span id="cb18-447"><a href="#cb18-447" aria-hidden="true" tabindex="-1"></a>remainder <span class="ot">&lt;-</span> decomp<span class="sc">$</span>time.series[, <span class="st">"remainder"</span>]</span>
<span id="cb18-448"><a href="#cb18-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-449"><a href="#cb18-449" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for ggplot</span></span>
<span id="cb18-450"><a href="#cb18-450" aria-hidden="true" tabindex="-1"></a>decomp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-451"><a href="#cb18-451" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> years,</span>
<span id="cb18-452"><a href="#cb18-452" aria-hidden="true" tabindex="-1"></a>  <span class="at">observed =</span> pop_ts_data<span class="sc">$</span>population,</span>
<span id="cb18-453"><a href="#cb18-453" aria-hidden="true" tabindex="-1"></a>  <span class="at">trend =</span> <span class="fu">as.numeric</span>(trend_component),</span>
<span id="cb18-454"><a href="#cb18-454" aria-hidden="true" tabindex="-1"></a>  <span class="at">seasonal =</span> <span class="fu">as.numeric</span>(seasonal_component),</span>
<span id="cb18-455"><a href="#cb18-455" aria-hidden="true" tabindex="-1"></a>  <span class="at">remainder =</span> <span class="fu">as.numeric</span>(remainder)</span>
<span id="cb18-456"><a href="#cb18-456" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-457"><a href="#cb18-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-458"><a href="#cb18-458" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize components with ggplot</span></span>
<span id="cb18-459"><a href="#cb18-459" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb18-460"><a href="#cb18-460" aria-hidden="true" tabindex="-1"></a>decomp_long <span class="ot">&lt;-</span> decomp_df <span class="sc">%&gt;%</span></span>
<span id="cb18-461"><a href="#cb18-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(observed, trend, seasonal, remainder),</span>
<span id="cb18-462"><a href="#cb18-462" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"component"</span>,</span>
<span id="cb18-463"><a href="#cb18-463" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb18-464"><a href="#cb18-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-465"><a href="#cb18-465" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(decomp_long, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb18-466"><a href="#cb18-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb18-467"><a href="#cb18-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>component, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-468"><a href="#cb18-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-469"><a href="#cb18-469" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Time Series Decomposition Components"</span>,</span>
<span id="cb18-470"><a href="#cb18-470" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb18-471"><a href="#cb18-471" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Value"</span></span>
<span id="cb18-472"><a href="#cb18-472" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-473"><a href="#cb18-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-474"><a href="#cb18-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-475"><a href="#cb18-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-476"><a href="#cb18-476" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb18-477"><a href="#cb18-477" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results Interpretation</span></span>
<span id="cb18-478"><a href="#cb18-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-479"><a href="#cb18-479" aria-hidden="true" tabindex="-1"></a>Time series decomposition reveals the structure of temporal data:</span>
<span id="cb18-480"><a href="#cb18-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-481"><a href="#cb18-481" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Trend Component**</span>
<span id="cb18-482"><a href="#cb18-482" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Shows the long-term direction of the population</span>
<span id="cb18-483"><a href="#cb18-483" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Increasing trend suggests population growth</span>
<span id="cb18-484"><a href="#cb18-484" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Can be linear or non-linear</span>
<span id="cb18-485"><a href="#cb18-485" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Important for long-term conservation planning</span>
<span id="cb18-486"><a href="#cb18-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-487"><a href="#cb18-487" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Seasonal Component**</span>
<span id="cb18-488"><a href="#cb18-488" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Reveals cyclic patterns in the data</span>
<span id="cb18-489"><a href="#cb18-489" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>In this example, shows a 5-year cycle</span>
<span id="cb18-490"><a href="#cb18-490" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Could represent environmental cycles (e.g., El Niño)</span>
<span id="cb18-491"><a href="#cb18-491" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Helps identify optimal monitoring times</span>
<span id="cb18-492"><a href="#cb18-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-493"><a href="#cb18-493" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Remainder (Residuals)**</span>
<span id="cb18-494"><a href="#cb18-494" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Random variation after removing trend and seasonality</span>
<span id="cb18-495"><a href="#cb18-495" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Should be approximately white noise if decomposition is appropriate</span>
<span id="cb18-496"><a href="#cb18-496" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Large residuals may indicate unusual events or data quality issues</span>
<span id="cb18-497"><a href="#cb18-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-498"><a href="#cb18-498" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Ecological Applications**</span>
<span id="cb18-499"><a href="#cb18-499" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Separate long-term trends from natural cycles</span>
<span id="cb18-500"><a href="#cb18-500" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Identify critical periods in species life cycles</span>
<span id="cb18-501"><a href="#cb18-501" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Detect anomalies or regime shifts</span>
<span id="cb18-502"><a href="#cb18-502" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Inform sampling design for monitoring programs</span>
<span id="cb18-503"><a href="#cb18-503" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-504"><a href="#cb18-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-505"><a href="#cb18-505" aria-hidden="true" tabindex="-1"></a><span class="fu">### Forecasting with ARIMA Models</span></span>
<span id="cb18-506"><a href="#cb18-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-509"><a href="#cb18-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-510"><a href="#cb18-510" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit an ARIMA model</span></span>
<span id="cb18-511"><a href="#cb18-511" aria-hidden="true" tabindex="-1"></a><span class="co"># auto.arima selects the best model automatically</span></span>
<span id="cb18-512"><a href="#cb18-512" aria-hidden="true" tabindex="-1"></a>arima_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(pop_ts)</span>
<span id="cb18-513"><a href="#cb18-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-514"><a href="#cb18-514" aria-hidden="true" tabindex="-1"></a><span class="co"># Display model summary</span></span>
<span id="cb18-515"><a href="#cb18-515" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arima_model)</span>
<span id="cb18-516"><a href="#cb18-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-517"><a href="#cb18-517" aria-hidden="true" tabindex="-1"></a><span class="co"># Make forecasts for the next 5 years</span></span>
<span id="cb18-518"><a href="#cb18-518" aria-hidden="true" tabindex="-1"></a>forecast_result <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima_model, <span class="at">h =</span> <span class="dv">5</span>)</span>
<span id="cb18-519"><a href="#cb18-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-520"><a href="#cb18-520" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the forecast</span></span>
<span id="cb18-521"><a href="#cb18-521" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(forecast_result) <span class="sc">+</span></span>
<span id="cb18-522"><a href="#cb18-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-523"><a href="#cb18-523" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Population Forecast (ARIMA Model)"</span>,</span>
<span id="cb18-524"><a href="#cb18-524" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"5-year forecast with 80% and 95% confidence intervals"</span>,</span>
<span id="cb18-525"><a href="#cb18-525" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb18-526"><a href="#cb18-526" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Population Size"</span></span>
<span id="cb18-527"><a href="#cb18-527" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-528"><a href="#cb18-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-529"><a href="#cb18-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-530"><a href="#cb18-530" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract forecast values</span></span>
<span id="cb18-531"><a href="#cb18-531" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-532"><a href="#cb18-532" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2024</span><span class="sc">:</span><span class="dv">2028</span>,</span>
<span id="cb18-533"><a href="#cb18-533" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_forecast =</span> <span class="fu">as.numeric</span>(forecast_result<span class="sc">$</span>mean),</span>
<span id="cb18-534"><a href="#cb18-534" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower_80 =</span> <span class="fu">as.numeric</span>(forecast_result<span class="sc">$</span>lower[, <span class="dv">1</span>]),</span>
<span id="cb18-535"><a href="#cb18-535" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper_80 =</span> <span class="fu">as.numeric</span>(forecast_result<span class="sc">$</span>upper[, <span class="dv">1</span>]),</span>
<span id="cb18-536"><a href="#cb18-536" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower_95 =</span> <span class="fu">as.numeric</span>(forecast_result<span class="sc">$</span>lower[, <span class="dv">2</span>]),</span>
<span id="cb18-537"><a href="#cb18-537" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper_95 =</span> <span class="fu">as.numeric</span>(forecast_result<span class="sc">$</span>upper[, <span class="dv">2</span>])</span>
<span id="cb18-538"><a href="#cb18-538" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-539"><a href="#cb18-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-540"><a href="#cb18-540" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(forecast_df)</span>
<span id="cb18-541"><a href="#cb18-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-542"><a href="#cb18-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-543"><a href="#cb18-543" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb18-544"><a href="#cb18-544" aria-hidden="true" tabindex="-1"></a><span class="fu">## PROFESSIONAL TIP: Time Series Forecasting in Ecology</span></span>
<span id="cb18-545"><a href="#cb18-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-546"><a href="#cb18-546" aria-hidden="true" tabindex="-1"></a>When forecasting ecological time series:</span>
<span id="cb18-547"><a href="#cb18-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-548"><a href="#cb18-548" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Model Selection**</span>
<span id="cb18-549"><a href="#cb18-549" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Use <span class="in">`auto.arima()`</span> for automatic model selection</span>
<span id="cb18-550"><a href="#cb18-550" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Consider seasonal ARIMA for data with clear seasonality</span>
<span id="cb18-551"><a href="#cb18-551" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Evaluate multiple models and compare AIC/BIC</span>
<span id="cb18-552"><a href="#cb18-552" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Check residual diagnostics to validate model assumptions</span>
<span id="cb18-553"><a href="#cb18-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-554"><a href="#cb18-554" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Forecast Interpretation**</span>
<span id="cb18-555"><a href="#cb18-555" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Point forecasts are the expected values</span>
<span id="cb18-556"><a href="#cb18-556" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Confidence intervals quantify uncertainty</span>
<span id="cb18-557"><a href="#cb18-557" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Uncertainty increases with forecast horizon</span>
<span id="cb18-558"><a href="#cb18-558" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Consider biological constraints (e.g., populations can't be negative)</span>
<span id="cb18-559"><a href="#cb18-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-560"><a href="#cb18-560" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Ecological Considerations**</span>
<span id="cb18-561"><a href="#cb18-561" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Short-term forecasts are more reliable than long-term</span>
<span id="cb18-562"><a href="#cb18-562" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Regime shifts or environmental changes can invalidate models</span>
<span id="cb18-563"><a href="#cb18-563" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Incorporate external covariates when available (e.g., climate indices)</span>
<span id="cb18-564"><a href="#cb18-564" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Use ensemble forecasts for robust predictions</span>
<span id="cb18-565"><a href="#cb18-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-566"><a href="#cb18-566" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Communication**</span>
<span id="cb18-567"><a href="#cb18-567" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Always show uncertainty in forecasts</span>
<span id="cb18-568"><a href="#cb18-568" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Explain assumptions and limitations</span>
<span id="cb18-569"><a href="#cb18-569" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Relate forecasts to management thresholds</span>
<span id="cb18-570"><a href="#cb18-570" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Update forecasts as new data become available</span>
<span id="cb18-571"><a href="#cb18-571" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-572"><a href="#cb18-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-573"><a href="#cb18-573" aria-hidden="true" tabindex="-1"></a><span class="fu">### Ecological Example: Phenology Trends</span></span>
<span id="cb18-574"><a href="#cb18-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-577"><a href="#cb18-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-578"><a href="#cb18-578" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb18-579"><a href="#cb18-579" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb18-580"><a href="#cb18-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-581"><a href="#cb18-581" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)  <span class="co"># For dwtest()</span></span>
<span id="cb18-582"><a href="#cb18-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-583"><a href="#cb18-583" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate phenological data (e.g., first flowering date)</span></span>
<span id="cb18-584"><a href="#cb18-584" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb18-585"><a href="#cb18-585" aria-hidden="true" tabindex="-1"></a>years_pheno <span class="ot">&lt;-</span> <span class="dv">1980</span><span class="sc">:</span><span class="dv">2023</span></span>
<span id="cb18-586"><a href="#cb18-586" aria-hidden="true" tabindex="-1"></a>n_years_pheno <span class="ot">&lt;-</span> <span class="fu">length</span>(years_pheno)</span>
<span id="cb18-587"><a href="#cb18-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-588"><a href="#cb18-588" aria-hidden="true" tabindex="-1"></a><span class="co"># Earlier flowering over time due to climate change</span></span>
<span id="cb18-589"><a href="#cb18-589" aria-hidden="true" tabindex="-1"></a>flowering_doy <span class="ot">&lt;-</span> <span class="dv">120</span> <span class="sc">-</span> <span class="fl">0.3</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span>n_years_pheno) <span class="sc">+</span> <span class="fu">rnorm</span>(n_years_pheno, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb18-590"><a href="#cb18-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-591"><a href="#cb18-591" aria-hidden="true" tabindex="-1"></a>pheno_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-592"><a href="#cb18-592" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> years_pheno,</span>
<span id="cb18-593"><a href="#cb18-593" aria-hidden="true" tabindex="-1"></a>  <span class="at">flowering_day =</span> <span class="fu">round</span>(flowering_doy)</span>
<span id="cb18-594"><a href="#cb18-594" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-595"><a href="#cb18-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-596"><a href="#cb18-596" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the trend</span></span>
<span id="cb18-597"><a href="#cb18-597" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pheno_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> flowering_day)) <span class="sc">+</span></span>
<span id="cb18-598"><a href="#cb18-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-599"><a href="#cb18-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb18-600"><a href="#cb18-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-601"><a href="#cb18-601" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Phenological Shift: First Flowering Date"</span>,</span>
<span id="cb18-602"><a href="#cb18-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Earlier flowering over time suggests climate warming"</span>,</span>
<span id="cb18-603"><a href="#cb18-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb18-604"><a href="#cb18-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Day of Year (First Flowering)"</span></span>
<span id="cb18-605"><a href="#cb18-605" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-606"><a href="#cb18-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-607"><a href="#cb18-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-608"><a href="#cb18-608" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a linear model to quantify the trend</span></span>
<span id="cb18-609"><a href="#cb18-609" aria-hidden="true" tabindex="-1"></a>pheno_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(flowering_day <span class="sc">~</span> year, <span class="at">data =</span> pheno_data)</span>
<span id="cb18-610"><a href="#cb18-610" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pheno_model)</span>
<span id="cb18-611"><a href="#cb18-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-612"><a href="#cb18-612" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the rate of change</span></span>
<span id="cb18-613"><a href="#cb18-613" aria-hidden="true" tabindex="-1"></a>rate_per_decade <span class="ot">&lt;-</span> <span class="fu">coef</span>(pheno_model)[<span class="st">"year"</span>] <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb18-614"><a href="#cb18-614" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Flowering is occurring %.2f days earlier per decade</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">abs</span>(rate_per_decade)))</span>
<span id="cb18-615"><a href="#cb18-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-616"><a href="#cb18-616" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for autocorrelation in residuals</span></span>
<span id="cb18-617"><a href="#cb18-617" aria-hidden="true" tabindex="-1"></a><span class="fu">dwtest</span>(pheno_model)</span>
<span id="cb18-618"><a href="#cb18-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-619"><a href="#cb18-619" aria-hidden="true" tabindex="-1"></a><span class="co"># If autocorrelation is present, use GLS</span></span>
<span id="cb18-620"><a href="#cb18-620" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb18-621"><a href="#cb18-621" aria-hidden="true" tabindex="-1"></a>gls_model <span class="ot">&lt;-</span> <span class="fu">gls</span>(flowering_day <span class="sc">~</span> year,</span>
<span id="cb18-622"><a href="#cb18-622" aria-hidden="true" tabindex="-1"></a>                 <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> year),</span>
<span id="cb18-623"><a href="#cb18-623" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> pheno_data)</span>
<span id="cb18-624"><a href="#cb18-624" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gls_model)</span>
<span id="cb18-625"><a href="#cb18-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-626"><a href="#cb18-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-627"><a href="#cb18-627" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb18-628"><a href="#cb18-628" aria-hidden="true" tabindex="-1"></a><span class="fu">## Phenological Trends and Climate Change</span></span>
<span id="cb18-629"><a href="#cb18-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-630"><a href="#cb18-630" aria-hidden="true" tabindex="-1"></a>Phenological shifts provide powerful evidence of climate change impacts:</span>
<span id="cb18-631"><a href="#cb18-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-632"><a href="#cb18-632" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Trend Detection**</span>
<span id="cb18-633"><a href="#cb18-633" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Linear regression can detect long-term trends</span>
<span id="cb18-634"><a href="#cb18-634" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Rate of change quantifies the magnitude of shifts</span>
<span id="cb18-635"><a href="#cb18-635" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Statistical significance indicates confidence in the trend</span>
<span id="cb18-636"><a href="#cb18-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-637"><a href="#cb18-637" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Temporal Autocorrelation**</span>
<span id="cb18-638"><a href="#cb18-638" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Phenological data often show autocorrelation</span>
<span id="cb18-639"><a href="#cb18-639" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Durbin-Watson test detects autocorrelation in residuals</span>
<span id="cb18-640"><a href="#cb18-640" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Generalized Least Squares (GLS) accounts for autocorrelation</span>
<span id="cb18-641"><a href="#cb18-641" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Proper modeling prevents inflated Type I error rates</span>
<span id="cb18-642"><a href="#cb18-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-643"><a href="#cb18-643" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Ecological Implications**</span>
<span id="cb18-644"><a href="#cb18-644" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Earlier flowering can lead to phenological mismatches</span>
<span id="cb18-645"><a href="#cb18-645" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Pollinators may not be active when plants flower</span>
<span id="cb18-646"><a href="#cb18-646" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Affects reproductive success and population dynamics</span>
<span id="cb18-647"><a href="#cb18-647" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Indicates ecosystem-wide climate change responses</span>
<span id="cb18-648"><a href="#cb18-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-649"><a href="#cb18-649" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Conservation Applications**</span>
<span id="cb18-650"><a href="#cb18-650" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Monitor phenological shifts as climate change indicators</span>
<span id="cb18-651"><a href="#cb18-651" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Identify species vulnerable to phenological mismatches</span>
<span id="cb18-652"><a href="#cb18-652" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Inform assisted migration decisions</span>
<span id="cb18-653"><a href="#cb18-653" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Guide adaptive management strategies</span>
<span id="cb18-654"><a href="#cb18-654" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-655"><a href="#cb18-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-656"><a href="#cb18-656" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb18-657"><a href="#cb18-657" aria-hidden="true" tabindex="-1"></a><span class="fu">## Code Explanation</span></span>
<span id="cb18-658"><a href="#cb18-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-659"><a href="#cb18-659" aria-hidden="true" tabindex="-1"></a>The phenology example demonstrates practical time series analysis:</span>
<span id="cb18-660"><a href="#cb18-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-661"><a href="#cb18-661" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Trend Analysis**</span>
<span id="cb18-662"><a href="#cb18-662" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Linear regression quantifies the rate of phenological shift</span>
<span id="cb18-663"><a href="#cb18-663" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Confidence intervals indicate precision of the estimate</span>
<span id="cb18-664"><a href="#cb18-664" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Visual inspection confirms the trend pattern</span>
<span id="cb18-665"><a href="#cb18-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-666"><a href="#cb18-666" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Autocorrelation Testing**</span>
<span id="cb18-667"><a href="#cb18-667" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Durbin-Watson test checks for temporal autocorrelation</span>
<span id="cb18-668"><a href="#cb18-668" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Significant autocorrelation requires specialized models</span>
<span id="cb18-669"><a href="#cb18-669" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>GLS with AR(1) correlation structure accounts for autocorrelation</span>
<span id="cb18-670"><a href="#cb18-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-671"><a href="#cb18-671" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Model Comparison**</span>
<span id="cb18-672"><a href="#cb18-672" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Compare standard linear model with GLS</span>
<span id="cb18-673"><a href="#cb18-673" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>GLS provides more accurate standard errors</span>
<span id="cb18-674"><a href="#cb18-674" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Prevents false positives in trend detection</span>
<span id="cb18-675"><a href="#cb18-675" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-676"><a href="#cb18-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-677"><a href="#cb18-677" aria-hidden="true" tabindex="-1"></a>Time series analysis is essential for understanding temporal dynamics in ecological systems. By properly accounting for temporal structure, we can detect trends, make forecasts, and understand how ecosystems respond to environmental change.</span>
<span id="cb18-678"><a href="#cb18-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-679"><a href="#cb18-679" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter Summary</span></span>
<span id="cb18-680"><a href="#cb18-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-681"><a href="#cb18-681" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Concepts</span></span>
<span id="cb18-682"><a href="#cb18-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-683"><a href="#cb18-683" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Model Interpretation**: DALEX framework provides model-agnostic interpretation methods</span>
<span id="cb18-684"><a href="#cb18-684" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Variable Importance**: Permutation importance quantifies predictor contributions</span>
<span id="cb18-685"><a href="#cb18-685" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Partial Dependence**: Shows average marginal effects of predictors</span>
<span id="cb18-686"><a href="#cb18-686" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**ICE Plots**: Reveal individual-level heterogeneity in predictions</span>
<span id="cb18-687"><a href="#cb18-687" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**SHAP Values**: Provide fair attribution of predictions to features</span>
<span id="cb18-688"><a href="#cb18-688" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Temporal Autocorrelation**: Nearby time points are often correlated</span>
<span id="cb18-689"><a href="#cb18-689" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Time Series Decomposition**: Separates trend, seasonal, and noise components</span>
<span id="cb18-690"><a href="#cb18-690" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**ARIMA Models**: Flexible framework for time series forecasting</span>
<span id="cb18-691"><a href="#cb18-691" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**GLS Models**: Account for temporal autocorrelation in regression</span>
<span id="cb18-692"><a href="#cb18-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-693"><a href="#cb18-693" aria-hidden="true" tabindex="-1"></a><span class="fu">### R Functions Learned</span></span>
<span id="cb18-694"><a href="#cb18-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-695"><a href="#cb18-695" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`explain_tidymodels()`</span> - Create DALEX explainer for tidymodels</span>
<span id="cb18-696"><a href="#cb18-696" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`model_parts()`</span> - Calculate variable importance</span>
<span id="cb18-697"><a href="#cb18-697" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`model_profile()`</span> - Create partial dependence and ICE plots</span>
<span id="cb18-698"><a href="#cb18-698" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`predict_parts()`</span> - Explain individual predictions</span>
<span id="cb18-699"><a href="#cb18-699" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`auto.arima()`</span> - Automatic ARIMA model selection</span>
<span id="cb18-700"><a href="#cb18-700" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`forecast()`</span> - Generate forecasts</span>
<span id="cb18-701"><a href="#cb18-701" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb18-702"><a href="#cb18-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-703"><a href="#cb18-703" aria-hidden="true" tabindex="-1"></a>This chapter explores advanced modeling techniques that extend beyond traditional regression (covered in <span class="co">[</span><span class="ot">Chapter 8</span><span class="co">](08-regression.qmd)</span>). We'll cover model interpretation methods that help us understand "black box" machine learning models, and time series analysis for data collected sequentially over time.</span>
<span id="cb18-704"><a href="#cb18-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-705"><a href="#cb18-705" aria-hidden="true" tabindex="-1"></a><span class="fu">### Next Steps</span></span>
<span id="cb18-706"><a href="#cb18-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-707"><a href="#cb18-707" aria-hidden="true" tabindex="-1"></a>Congratulations on completing *Data Analysis in Natural Sciences*! You now possess a comprehensive toolkit for analyzing ecological data, from data cleaning and visualization to advanced modeling and interpretation.</span>
<span id="cb18-708"><a href="#cb18-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-709"><a href="#cb18-709" aria-hidden="true" tabindex="-1"></a>To continue your journey:</span>
<span id="cb18-710"><a href="#cb18-710" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Apply these techniques to your own datasets</span>
<span id="cb18-711"><a href="#cb18-711" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explore the documentation for packages like <span class="in">`tidymodels`</span>, <span class="in">`DALEX`</span>, and <span class="in">`fable`</span></span>
<span id="cb18-712"><a href="#cb18-712" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Join the R for Data Science community to keep learning</span>
<span id="cb18-713"><a href="#cb18-713" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Contribute to open-source projects in ecology and conservation</span>
<span id="cb18-714"><a href="#cb18-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-715"><a href="#cb18-715" aria-hidden="true" tabindex="-1"></a>For applied examples in conservation science, check out <span class="co">[</span><span class="ot">Chapter 10: Conservation Applications</span><span class="co">](10-conservation.qmd)</span>.</span>
<span id="cb18-716"><a href="#cb18-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-717"><a href="#cb18-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-718"><a href="#cb18-718" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb18-719"><a href="#cb18-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-720"><a href="#cb18-720" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Model Interpretation**: Use DALEX to interpret a random forest model predicting species abundance. Which environmental variables are most important?</span>
<span id="cb18-721"><a href="#cb18-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-722"><a href="#cb18-722" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Partial Dependence**: Create partial dependence plots for the top 3 most important variables. Do the relationships make ecological sense?</span>
<span id="cb18-723"><a href="#cb18-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-724"><a href="#cb18-724" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Individual Predictions**: Select an unusual prediction (outlier) and use SHAP values to explain why the model made that prediction.</span>
<span id="cb18-725"><a href="#cb18-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-726"><a href="#cb18-726" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Time Series Decomposition**: Analyze a real ecological time series (e.g., population counts, temperature data). Decompose it and interpret the components.</span>
<span id="cb18-727"><a href="#cb18-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-728"><a href="#cb18-728" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**ARIMA Forecasting**: Build an ARIMA model for a population time series. How far into the future can you reliably forecast?</span>
<span id="cb18-729"><a href="#cb18-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-730"><a href="#cb18-730" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Phenology Analysis**: Analyze phenological data (e.g., bird arrival dates, flowering times) for evidence of climate change. Account for temporal autocorrelation.</span>
<span id="cb18-731"><a href="#cb18-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-732"><a href="#cb18-732" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**Model Comparison**: Compare interpretations from different ML models (random forest, gradient boosting, neural network) on the same dataset. Do they agree on variable importance?</span>
<span id="cb18-733"><a href="#cb18-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-734"><a href="#cb18-734" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>**Ensemble Interpretation**: Create an ensemble model and interpret it. How does the interpretation differ from individual models?</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 Jimmy Moses</p>
</div>   
    <div class="nav-footer-center">
<p>⚠️ <strong>DRAFT - EDITION 1</strong> ⚠️</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jm0535/dains/edit/main/chapters/09-advanced-modeling.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/jm0535/dains/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/jm0535/dains/blob/main/chapters/09-advanced-modeling.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>


<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>